#!/bin/bash
# -*- mode: sh -*-
#
export GOPATH=$HOME/develop/ghq
export GHQ_ROOT=$GOPATH/src

export LANG=ja_JP.UTF-8
export LC_ALL=ja_JP.UTF-8
export COLORTERM=rxvt-256unicode

# environment variables for X11/wayland
export XMODIFIERS="@im=fcitx"
export GTK_IM_MODULE="fcitx"
export QT_IM_MODULE="fcitx"
export XDG_RUNTIME_DIR=/tmp/1000-runtime-dir

if [ ! -d "$XDG_RUNTIME_DIR" ]; then
    mkdir -p $XDG_RUNTIME_DIR
    chmod 0700 $XDG_RUNTIME_DIR
fi

# use openjdk in gentoo
if [ -d "/usr/lib64/openjdk-11" ]; then
    export JAVA_HOME=/usr/lib64/openjdk-11
elif [ -x java-config ]; then
    export JAVA_HOME=`java-config -O`
fi

export NPM_PACKAGES=$HOME/.npm-packages

export MANPATH=$NPM_PACKAGES/share/man:$MANPATH

export PATH=$NPM_PACKAGES/bin:$JAVA_HOME/bin:$HOME/.npm/bin:$HOME/.anyenv/bin:$HOME/.anyenv/envs/nodenv/shims:$GOPATH/bin:$HOME/.roswell/bin:$HOME/.cargo/bin:/opt/VirtualBox:$HOME/bin:$PATH

if [ -f "$HOME/.opam/opam-init/init.sh" ]; then
    . $HOME/.opam/opam-init/init.sh
fi

if [ -f "$HOME/.secrets/bash" ]; then
    source $HOME/.secrets/bash
fi

# WSL_DISTRO_NAMEにDistributionの名前が入っているので、これが設定されていたらWSLの内部と判断する
if [ "$WSL_DISTRO_NAME" != "" ]; then
    cd '/mnt/c/Program Files/VcXsrv'

    export DISPLAY=127.0.0.1:0.0
    WSLENV=DISPLAY ./xhost.exe + $(ip -4 a show eth0 | grep -oP '(?<=inet\s)\d+(\.\d+){3}')

    export DISPLAY=$(awk '/^nameserver/ {print $2; exit}' /etc/resolv.conf):0.0
    export LIBGL_ALWAYS_INDIRECT=1
fi


# Start programs for sway session
if [[ $XDG_SESSION_TYPE == "wayland" ]]; then
    if [ -x "$HOME/.dropbox-dist/dropboxd" ]; then
        $HOME/.dropbox-dist/dropboxd &
    fi
fi
